<Window
    x:Class="JiraWidget.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:JiraWidget">

    <Border x:Name="AppArea"
            CornerRadius="12"
            Background="#222">
        <Border.Resources>
            <Style x:Key="TitleBarButtonStyle" TargetType="Button">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="Foreground" Value="White"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="FontSize" Value="12"/>
                <Setter Property="FontWeight" Value="Bold"/>
                <Setter Property="Width" Value="32"/>
                <Setter Property="Height" Value="32"/>
            </Style>
        </Border.Resources>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="32"/> <!-- Title bar area -->
                <RowDefinition Height="*"/>   <!-- Content area -->
            </Grid.RowDefinitions>

            <!-- Draggable Title Bar Area -->
            <Grid x:Name="DragArea" Grid.Row="0">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Top">
                    <Button x:Name="MinimizeButton" Content="-" Click="MinimizeButton_Click" Style="{StaticResource TitleBarButtonStyle}"/>
                    <Button x:Name="CloseButton" Content="X" Click="CloseButton_Click" Style="{StaticResource TitleBarButtonStyle}"/>
                </StackPanel>
            </Grid>

            <!-- Content Area -->
            <Grid Grid.Row="1" Padding="15,0,15,15">

                <!-- Login View -->
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel x:Name="LoginView" Spacing="10" Padding="0,10,0,10">
                        <TextBlock Text="Connect to Jira" HorizontalAlignment="Center" FontSize="16" FontWeight="SemiBold" Foreground="White"/>
                        <TextBlock Text="Jira URL" Foreground="White" Margin="0,0,0,4"/>
                        <TextBox x:Name="JiraUrlTextBox" PlaceholderText="https://your-domain.atlassian.net"/>
                        <TextBlock Text="Personal Access Token" Foreground="White" Margin="0,10,0,4"/>
                        <TextBox x:Name="PatTextBox" PlaceholderText="Your Jira Personal Access Token"/>
                        <Button x:Name="ConnectButton" Content="Connect (PAT)" Click="ConnectButton_Click" HorizontalAlignment="Center"/>
                        <Button x:Name="OktaLoginButton" Content="Login with Okta (Browser)" Click="OktaLoginButton_Click" HorizontalAlignment="Center"/>
                        <Border x:Name="OktaWebViewHost" Background="#111" CornerRadius="8" Padding="6" Visibility="Collapsed">
                            <StackPanel Spacing="8">
                                <WebView2 x:Name="OktaWebView" Height="360"/>
                                <Button x:Name="OktaContinueButton" Content="Continue" Click="OktaContinueButton_Click" HorizontalAlignment="Right"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>

                <!-- Main View -->
                <Grid x:Name="MainView" Visibility="Collapsed" Margin="0,10,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Input Area -->
                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="IssueKeyTextBox" Grid.Column="0" PlaceholderText="Enter Issue Key (e.g., PC-12345)"/>
                        <Button x:Name="TrackButton" Grid.Column="1" Content="Track" Click="TrackButton_Click" Margin="5,0,0,0"/>
                    </Grid>

                    <!-- Issues List -->
                    <ScrollViewer Grid.Row="1" Margin="0,10,0,0" VerticalScrollBarVisibility="Auto">
                        <ItemsControl x:Name="TrackedIssuesItemsControl">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="local:TrackedIssueViewModel">
                                    <Grid Margin="0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="{x:Bind DisplayText, Mode=OneWay}" FontWeight="SemiBold"/>
                                            <ProgressBar Value="{x:Bind Progress, Mode=OneWay}" Margin="0,4,0,0"/>
                                        </StackPanel>
                                        <Button x:Name="RemoveButton" Content="X" Grid.Column="1" Click="RemoveButton_Click" VerticalAlignment="Center" Margin="10,0,0,0" Style="{StaticResource TitleBarButtonStyle}"/>
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    
                    <!-- Logout Button -->
                    <Button x:Name="LogoutButton" Content="Logout" Click="LogoutButton_Click" Grid.Row="2" VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="0,10,0,5"/>
                </Grid>
            </Grid>
        </Grid>
    </Border>

</Window>
